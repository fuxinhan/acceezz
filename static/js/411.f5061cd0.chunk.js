"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[411],{9411:(e,s,a)=>{a.r(s),a.d(s,{default:()=>me});var r=a(9379),n=a(5043);const l="UserInfo_UserInfoPage__e810E",t="UserInfo_layout__zZ4UQ",c="UserInfo_sideMenu__a3RFU",i="UserInfo_menuItem__OYe7J",o="UserInfo_active__VyX9j",d="UserInfo_arrow__y3enO",h="UserInfo_content__rGOx-",m="UserInfo_section__4H76F",u="UserInfo_headerBar__femp9",x="UserInfo_title__iQeDo",_="UserInfo_sub__AnKl3",p="UserInfo_link__ga2a4",j="UserInfo_profileTop__48vwc",v="UserInfo_leftIntro__iCeAX",f="UserInfo_nameBlock__7EIAT",N="UserInfo_name__f0+if",g="UserInfo_location__wQ8XV",y="UserInfo_fieldList__EjPt4",w="UserInfo_fieldRow__KGF-3",A="UserInfo_fieldLabel__6Dvvb",I="UserInfo_fieldValue__EvUrJ",U="UserInfo_primaryBtn__lyv1k",b="UserInfo_card__aT8Tp",M="UserInfo_metaGrid__Fdt8f",P="UserInfo_metaLabel__RoiiM",C="UserInfo_metaValue__kFyBp",S="UserInfo_blockTitle__ToraI",k="UserInfo_inlineForm__XlPlI",E="UserInfo_modalActions__y9IEl",Y="UserInfo_avatarClickable__6v477",T="UserInfo_avatarModal__ZVD2q",X="UserInfo_cropperBody__vSO+J",F="UserInfo_emptyUploader__IKNl4",D="UserInfo_cropBox__vJJzx",R="UserInfo_cropImage__8Z677",q="UserInfo_cropMask__vEYyq",L="UserInfo_controls__Me8N2",O="UserInfo_scaleRow__CqsM6",V="UserInfo_scaleLabel__U5cu9",W="UserInfo_scaleSlider__UjZ3b",B="UserInfo_actionRow__1yNl1";var J=a(4400),z=a(5964),G=a(5492),H=a(2703),Z=a(7e3),K=a(5367),Q=a(5981),$=a(4593),ee=a(5558),se=a(2544),ae=a(1902),re=a(446),ne=a.n(re),le=a(579);const te="profile",ce="password",ie="preferences",oe="membership";function de(){try{const e=localStorage.getItem("userInfo");return e?JSON.parse(e):null}catch(e){return null}}function he(){const e=de(),s=(null===e||void 0===e?void 0:e.user_info)||{};return{username:s.username||"Member",name:s.name||"Accezz",avatar:s.cover||null,location:s.location||"\u2014",date_of_birth:s.date_of_birth||null,address:s.address||"",phone:s.phone||""}}const me=()=>{var e;const[s,a]=(0,n.useState)(te),[re,me]=(0,n.useState)(he()),[ue,xe]=(0,n.useState)(!1),[_e,pe]=(0,n.useState)(!1),[je,ve]=(0,n.useState)(!1),[fe,Ne]=(0,n.useState)(null),[ge,ye]=(0,n.useState)(1),[we,Ae]=(0,n.useState)({x:0,y:0}),Ie=(0,n.useRef)({dragging:!1,startX:0,startY:0,originX:0,originY:0}),Ue=(0,n.useRef)({startDistance:0,startScale:1}),be=(0,n.useRef)(null),Me=(0,n.useRef)(null),Pe=(0,n.useRef)(null),Ce=()=>{se.A.get({url:"api_v1/user/-1/",actionType:(0,ae.A)().GetUserInfo,Success:e=>{me(s=>(0,r.A)((0,r.A)({},s),e))}})};(0,n.useEffect)(()=>{me(he()),Ce()},[]);const Se=()=>{localStorage.clear(),window.location.reload(!0)},ke=()=>{var e;null===(e=Me.current)||void 0===e||e.click()},Ee=(e,s)=>{Ie.current={dragging:!0,startX:e,startY:s,originX:we.x,originY:we.y}},Ye=(e,s)=>{const a=Ie.current;if(!a.dragging)return;const r=e-a.startX,n=s-a.startY;Ae({x:a.originX+r,y:a.originY+n})},Te=()=>{Ie.current.dragging=!1},Xe=(e,s,a)=>Math.max(s,Math.min(a,e)),Fe=(0,n.useMemo)(()=>(0,le.jsxs)("aside",{className:c,children:[(0,le.jsxs)("div",{className:s===te?"".concat(i," ").concat(o):i,onClick:()=>a(te),children:[(0,le.jsx)("span",{children:"Profile"}),(0,le.jsx)("span",{className:d,children:"\u203a"})]}),(0,le.jsxs)("div",{className:s===ce?"".concat(i," ").concat(o):i,onClick:()=>a(ce),children:[(0,le.jsx)("span",{children:"Change password"}),(0,le.jsx)("span",{className:d,children:"\u203a"})]}),(0,le.jsxs)("div",{className:s===ie?"".concat(i," ").concat(o):i,onClick:()=>a(ie),children:[(0,le.jsx)("span",{children:"Preferences"}),(0,le.jsx)("span",{className:d,children:"\u203a"})]}),(0,le.jsxs)("div",{className:s===oe?"".concat(i," ").concat(o):i,onClick:()=>a(oe),children:[(0,le.jsx)("span",{children:"Membership application"}),(0,le.jsx)("span",{className:d,children:"\u203a"})]}),(0,le.jsxs)("div",{className:i,onClick:Se,children:[(0,le.jsx)("span",{children:"Sign out"}),(0,le.jsx)("span",{className:d,children:"\u203a"})]})]}),[s]),De=/^\d+$/,Re=/^[a-zA-Z]+$/;return(0,le.jsx)("div",{className:l,children:(0,le.jsxs)("div",{className:t,children:[Fe,(0,le.jsxs)("main",{className:h,children:[s===te&&(0,le.jsxs)("section",{className:m,children:[(0,le.jsxs)("header",{className:u,children:[(0,le.jsx)("h2",{className:x,children:"Profile"}),(0,le.jsxs)("p",{className:_,children:["Here you can edit your phone number and email address. This information is not visible to others. If you need to amend your personal details please get in touch. ",(0,le.jsx)("a",{className:p,href:"#",children:"Contact us"})]})]}),(0,le.jsx)("div",{className:j,children:(0,le.jsxs)("div",{className:v,children:[(0,le.jsx)("div",{className:Y,onClick:()=>{ve(!0)},title:"\u70b9\u51fb\u66f4\u6362\u5934\u50cf",children:(0,le.jsx)(z.A,{size:80,src:se.A.returnFileUrl(re.avatar),children:null===(e=re.username)||void 0===e?void 0:e[0]})}),(0,le.jsxs)("div",{className:f,children:[(0,le.jsx)("div",{className:N,children:re.username}),(0,le.jsxs)("div",{className:g,children:["Location: ",re.location||"\u2014"]})]})]})}),(0,le.jsxs)("div",{className:y,children:[(0,le.jsxs)("div",{className:w,children:[(0,le.jsx)("div",{className:A,children:"Name"}),(0,le.jsx)("div",{className:I,children:re.name})]}),(0,le.jsxs)("div",{className:w,children:[(0,le.jsx)("div",{className:A,children:"Birthday"}),(0,le.jsx)("div",{className:I,children:re.date_of_birth||"\u2014"})]}),(0,le.jsxs)("div",{className:w,children:[(0,le.jsx)("div",{className:A,children:"Location"}),(0,le.jsx)("div",{className:I,children:re.location||"\u2014"})]}),(0,le.jsxs)("div",{className:w,children:[(0,le.jsx)("div",{className:A,children:"Phone"}),(0,le.jsx)("div",{className:I,children:re.phone||"\u2014"})]}),(0,le.jsxs)("div",{className:w,children:[(0,le.jsx)("div",{className:A,children:"Gender"}),(0,le.jsx)("div",{className:I,children:re.gender||"\u2014"})]})]}),(0,le.jsx)(G.Ay,{className:U,onClick:()=>xe(!0),children:"Edit information"}),(0,le.jsx)(H.A,{title:"Edit profile",open:ue,onCancel:()=>xe(!1),footer:null,destroyOnClose:!0,children:(0,le.jsxs)(Z.A,{layout:"vertical",initialValues:re,onFinish:e=>{const s=(0,r.A)({},e);se.A.patch({url:"/api_v1/user/-1/",data:s,actionType:(0,ae.A)().PatchUserInfo,Success:()=>{Ce(),me(s=>(0,r.A)((0,r.A)({},s),e)),J.Ay.success("\u221a")}}),xe(!1)},children:[(0,le.jsx)(Z.A.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Please enter your name"}],children:(0,le.jsx)(K.A,{placeholder:"name"})}),(0,le.jsx)(Z.A.Item,{label:"Date of birth",name:"date_of_birth",getValueProps:e=>({value:e?ne()(e):null}),normalize:e=>e?ne()(e).format("YYYY-MM-DD"):null,children:(0,le.jsx)(Q.A,{style:{width:"100%"}})}),(0,le.jsx)(Z.A.Item,{label:"Location",name:"location",children:(0,le.jsx)(K.A,{placeholder:"location"})}),(0,le.jsx)(Z.A.Item,{label:"Phone",name:"phone",children:(0,le.jsx)(K.A,{placeholder:"Phone"})}),(0,le.jsx)(Z.A.Item,{label:"Gender",name:"gender",children:(0,le.jsxs)($.Ay.Group,{children:[(0,le.jsx)($.Ay,{value:"Female",children:" Female "}),(0,le.jsx)($.Ay,{value:"Male",children:" Male "}),(0,le.jsx)($.Ay,{value:"Other",children:" Other "})]})}),(0,le.jsxs)("div",{className:E,children:[(0,le.jsx)(G.Ay,{onClick:()=>xe(!1),children:"Cancel"}),(0,le.jsx)(G.Ay,{type:"primary",htmlType:"submit",children:"Save"})]})]})}),(0,le.jsxs)(H.A,{title:"Change avatar",open:je,onCancel:()=>ve(!1),footer:null,destroyOnClose:!0,className:T,children:[(0,le.jsx)("input",{ref:Me,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{var s;const a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!a)return;const r=new FileReader;r.onload=()=>{Ne(r.result),ye(1),Ae({x:0,y:0})},r.readAsDataURL(a),e.target.value=""}}),(0,le.jsx)("div",{className:X,children:fe?(0,le.jsxs)(le.Fragment,{children:[(0,le.jsxs)("div",{className:D,ref:Pe,onMouseDown:e=>{e.preventDefault(),Ee(e.clientX,e.clientY)},onMouseMove:e=>{Ye(e.clientX,e.clientY)},onMouseUp:Te,onMouseLeave:Te,onTouchStart:e=>{const s=e.touches;if(1===s.length){const e=s[0];Ee(e.clientX,e.clientY)}else if(2===s.length){const e=s[0],a=s[1],r=Math.sqrt(Math.pow(a.clientX-e.clientX,2)+Math.pow(a.clientY-e.clientY,2));Ue.current={startDistance:r,startScale:ge}}},onTouchMove:e=>{const s=e.touches;if(1===s.length){const e=s[0];Ye(e.clientX,e.clientY)}else if(2===s.length){const e=s[0],a=s[1],r=Math.sqrt(Math.pow(a.clientX-e.clientX,2)+Math.pow(a.clientY-e.clientY,2)),{startDistance:n,startScale:l}=Ue.current;if(n>0){const e=Xe(l*(r/n),.5,4);if(ye(e),be.current&&Pe.current){const s=Pe.current.clientWidth,a=be.current,r=a.naturalWidth,n=a.naturalHeight,l=Math.max(s/r,s/n)*e,t=r*l,c=n*l,i=Math.max(0,(t-s)/2),o=Math.max(0,(c-s)/2);Ae(e=>({x:Xe(e.x,-i,i),y:Xe(e.y,-o,o)}))}}}},onTouchEnd:Te,onWheel:e=>{e.preventDefault();const s=e.deltaY>0?-.1:.1,a=Xe(ge+s,.5,4);if(ye(a),be.current&&Pe.current){const e=Pe.current.clientWidth,s=be.current,r=s.naturalWidth,n=s.naturalHeight,l=Math.max(e/r,e/n)*a,t=r*l,c=n*l,i=Math.max(0,(t-e)/2),o=Math.max(0,(c-e)/2);Ae(e=>({x:Xe(e.x,-i,i),y:Xe(e.y,-o,o)}))}},children:[(0,le.jsx)("img",{ref:be,src:fe,alt:"avatar",className:R,style:{transform:"translate(-50%, -50%) translate(".concat(we.x,"px, ").concat(we.y,"px) scale(").concat(ge,")")},draggable:!1}),(0,le.jsx)("div",{className:q})]}),(0,le.jsxs)("div",{className:L,children:[(0,le.jsxs)("div",{className:O,children:[(0,le.jsx)("span",{className:V,children:"\u7f29\u653e"}),(0,le.jsx)(ee.A,{className:W,min:.1,max:4,step:.01,value:ge,onChange:e=>{const s=Xe(e,.1,4);if(ye(s),be.current&&Pe.current){const e=Pe.current.clientWidth,a=be.current,r=a.naturalWidth,n=a.naturalHeight,l=Math.max(e/r,e/n)*s,t=r*l,c=n*l,i=Math.max(0,(t-e)/2),o=Math.max(0,(c-e)/2);Ae(e=>({x:Xe(e.x,-i,i),y:Xe(e.y,-o,o)}))}}})]}),(0,le.jsxs)("div",{className:B,children:[(0,le.jsx)(G.Ay,{onClick:ke,children:"\u91cd\u65b0\u9009\u62e9"}),(0,le.jsx)(G.Ay,{type:"primary",onClick:()=>{const e=(()=>{const e=be.current,s=Pe.current;if(!e||!s)return null;const a=s.clientWidth,r=document.createElement("canvas");r.width=a,r.height=a;const n=r.getContext("2d");if(!n)return null;const l=e.naturalWidth,t=e.naturalHeight,c=Math.max(a/l,a/t)*ge,i=l*c,o=t*c,d=a/2+we.x-i/2,h=a/2+we.y-o/2;return n.clearRect(0,0,a,a),n.drawImage(e,d,h,i,o),r.toDataURL("image/png")})();if(!e)return void J.Ay.error("\u88c1\u526a\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5");const s=e.split(",")[1],a=atob(s),n=new Uint8Array(a.length);for(let r=0;r<a.length;r++)n[r]=a.charCodeAt(r);const l=new Blob([n],{type:"image/jpeg"}),t=new FormData;t.append("cover",l,"avatar.jpg"),se.A.post({url:"programmer/set_password/",data:t,actionType:(0,ae.A)().PostUserCover,Success:e=>{let s=de(),a=(0,r.A)((0,r.A)({},s.user_info),{},{cover:e.src});s.user_info=a,localStorage.setItem("userInfo",JSON.stringify(s)),me(s=>(0,r.A)((0,r.A)({},s),{},{avatar:e.src})),window.dispatchEvent(new CustomEvent("userAvatarUpdated",{detail:{avatar:e.src}}))},Error:e=>{console.log(e)}}),console.log("submit_avatar",{avatarDataUrl:e}),J.Ay.success("\u5df2\u6253\u5370\u5230\u63a7\u5236\u53f0"),ve(!1)},children:"\u4fdd\u5b58\u5934\u50cf"})]})]})]}):(0,le.jsx)("div",{className:F,children:(0,le.jsx)(G.Ay,{type:"primary",onClick:ke,children:"\u9009\u62e9\u56fe\u7247"})})})]})]}),s===ce&&(0,le.jsxs)("section",{className:m,children:[(0,le.jsx)("header",{className:u,children:(0,le.jsx)("h2",{className:x,children:"Change password"})}),(0,le.jsxs)(Z.A,{layout:"vertical",className:b,onFinish:e=>{console.log("change_password",e),se.A.post({url:"programmer/set_password/",data:e,actionType:(0,ae.A)().postPassword,Success:e=>{J.Ay.success("Password changed successfully, please log in again \u221a "),se.A.LogOut()},Error:()=>{J.Ay.error("X")}}),pe(!1)},children:[(0,le.jsx)(Z.A.Item,{label:"Current password",name:"old_password",rules:[{required:!0,message:"Please enter the current password"}],children:(0,le.jsx)(K.A.Password,{placeholder:"Current password"})}),(0,le.jsx)(Z.A.Item,{label:"New password",name:"new_password",rules:[{required:!0,message:"Please enter a new password"},{min:8,message:"Password must be at least 8 characters"},{max:20,message:"Password cannot exceed 20 characters"},e=>{let{getFieldValue:s}=e;return{validator:(e,a)=>a&&s("old_password")===a?Promise.reject(new Error("New password cannot be the same as current password")):Promise.resolve()}},{validator:(e,s)=>s&&De.test(s)?Promise.reject(new Error("Password cannot be all numbers")):Promise.resolve()},{validator:(e,s)=>s&&Re.test(s)?Promise.reject(new Error("Password cannot be all letters")):Promise.resolve()}],children:(0,le.jsx)(K.A.Password,{placeholder:"New password"})}),(0,le.jsx)(Z.A.Item,{label:"Confirm password",name:"confirmPassword",dependencies:["new_password"],rules:[{required:!0,message:"Please confirm the password"},e=>{let{getFieldValue:s}=e;return{validator:(e,a)=>a&&s("new_password")!==a?Promise.reject(new Error("The two passwords that you entered do not match!")):Promise.resolve()}}],children:(0,le.jsx)(K.A.Password,{placeholder:"Confirm password"})}),(0,le.jsx)(G.Ay,{className:U,htmlType:"submit",children:"Update password"})]})]}),s===oe&&(0,le.jsxs)("section",{className:m,children:[(0,le.jsx)("header",{className:u,children:(0,le.jsx)("h2",{className:x,children:"Membership application"})}),(0,le.jsx)("div",{className:b,children:(0,le.jsxs)("div",{className:M,children:[(0,le.jsxs)("div",{children:[(0,le.jsx)("div",{className:P,children:"Tier"}),(0,le.jsx)("div",{className:C,children:(null===re||void 0===re?void 0:re.tier)||"--"})]}),(0,le.jsxs)("div",{children:[(0,le.jsx)("div",{className:P,children:"Join date"}),(0,le.jsx)("div",{className:C,children:(null===re||void 0===re?void 0:re.joining_date)||"--"})]}),(0,le.jsxs)("div",{children:[(0,le.jsx)("div",{className:P,children:"Expiry"}),(0,le.jsx)("div",{className:C,children:(null===re||void 0===re?void 0:re.expiry)||"--"})]})]})}),(0,le.jsxs)("div",{className:b,children:[(0,le.jsx)("div",{className:S,children:"Propose a new member"}),(0,le.jsxs)(Z.A,{layout:"inline",onFinish:e=>{J.Ay.success("This feature is not yet complete")},className:k,children:[(0,le.jsx)(Z.A.Item,{name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u59d3\u540d"}],children:(0,le.jsx)(K.A,{placeholder:"Name"})}),(0,le.jsx)(Z.A.Item,{name:"email",rules:[{required:!0,message:"\u8bf7\u8f93\u5165Email"}],children:(0,le.jsx)(K.A,{placeholder:"Email"})}),(0,le.jsx)(Z.A.Item,{children:(0,le.jsx)(G.Ay,{type:"primary",htmlType:"submit",children:"Submit"})})]})]})]}),s===ie&&(0,le.jsxs)("section",{className:m,children:[(0,le.jsxs)("header",{className:u,children:[(0,le.jsx)("h2",{className:x,children:"Preferences"}),(0,le.jsx)("p",{className:_,children:"You can set your basic preferences here."})]}),(0,le.jsx)("div",{className:b,children:"No preferences yet."})]})]})]})})}}}]);
//# sourceMappingURL=411.f5061cd0.chunk.js.map