"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[411],{9411:(e,s,a)=>{a.r(s),a.d(s,{default:()=>he});var n=a(9379),r=a(5043);const l="UserInfo_UserInfoPage__e810E",c="UserInfo_layout__zZ4UQ",i="UserInfo_sideMenu__a3RFU",t="UserInfo_menuItem__OYe7J",o="UserInfo_active__VyX9j",d="UserInfo_arrow__y3enO",h="UserInfo_content__rGOx-",m="UserInfo_section__4H76F",u="UserInfo_headerBar__femp9",x="UserInfo_title__iQeDo",_="UserInfo_sub__AnKl3",j="UserInfo_link__ga2a4",p="UserInfo_profileTop__48vwc",f="UserInfo_leftIntro__iCeAX",v="UserInfo_nameBlock__7EIAT",N="UserInfo_name__f0+if",g="UserInfo_location__wQ8XV",y="UserInfo_fieldList__EjPt4",I="UserInfo_fieldRow__KGF-3",A="UserInfo_fieldLabel__6Dvvb",U="UserInfo_fieldValue__EvUrJ",w="UserInfo_primaryBtn__lyv1k",b="UserInfo_card__aT8Tp",M="UserInfo_metaGrid__Fdt8f",C="UserInfo_metaLabel__RoiiM",S="UserInfo_metaValue__kFyBp",k="UserInfo_blockTitle__ToraI",Y="UserInfo_inlineForm__XlPlI",P="UserInfo_modalActions__y9IEl",E="UserInfo_avatarClickable__6v477",X="UserInfo_avatarModal__ZVD2q",D="UserInfo_cropperBody__vSO+J",T="UserInfo_emptyUploader__IKNl4",R="UserInfo_cropBox__vJJzx",F="UserInfo_cropImage__8Z677",q="UserInfo_cropMask__vEYyq",L="UserInfo_controls__Me8N2",W="UserInfo_scaleRow__CqsM6",J="UserInfo_scaleLabel__U5cu9",O="UserInfo_scaleSlider__UjZ3b",B="UserInfo_actionRow__1yNl1";var G=a(4400),V=a(5964),H=a(5e3),z=a(2703),Z=a(4209),K=a(5367),Q=a(5981),$=a(5558),ee=a(705),se=a(1902),ae=a(446),ne=a.n(ae),re=a(579);const le="profile",ce="password",ie="preferences",te="membership";function oe(){try{const e=localStorage.getItem("userInfo");return e?JSON.parse(e):null}catch(e){return null}}function de(){const e=oe(),s=(null===e||void 0===e?void 0:e.user_info)||{};return{username:s.username||"Member",email:s.email||"member@example.com",avatar:s.cover||null,location:s.location||"\u2014",date_of_birth:s.date_of_birth||null,address:s.address||"",phone:s.phone||""}}const he=()=>{var e;const[s,a]=(0,r.useState)(le),[ae,he]=(0,r.useState)(de()),[me,ue]=(0,r.useState)(!1),[xe,_e]=(0,r.useState)(!1),[je,pe]=(0,r.useState)(!1),[fe,ve]=(0,r.useState)(null),[Ne,ge]=(0,r.useState)(1),[ye,Ie]=(0,r.useState)({x:0,y:0}),Ae=(0,r.useRef)({dragging:!1,startX:0,startY:0,originX:0,originY:0}),Ue=(0,r.useRef)({startDistance:0,startScale:1}),we=(0,r.useRef)(null),be=(0,r.useRef)(null),Me=(0,r.useRef)(null),Ce=()=>{ee.A.get({url:"api_v1/user/-1/",actionType:(0,se.A)().GetUserInfo,Success:e=>{he(s=>(0,n.A)((0,n.A)({},s),e))}})};(0,r.useEffect)(()=>{he(de()),Ce()},[]);const Se=()=>{localStorage.clear(),window.location.reload(!0)},ke=()=>{var e;null===(e=be.current)||void 0===e||e.click()},Ye=(e,s)=>{Ae.current={dragging:!0,startX:e,startY:s,originX:ye.x,originY:ye.y}},Pe=(e,s)=>{const a=Ae.current;if(!a.dragging)return;const n=e-a.startX,r=s-a.startY;Ie({x:a.originX+n,y:a.originY+r})},Ee=()=>{Ae.current.dragging=!1},Xe=(e,s,a)=>Math.max(s,Math.min(a,e)),De=(0,r.useMemo)(()=>(0,re.jsxs)("aside",{className:i,children:[(0,re.jsxs)("div",{className:s===le?"".concat(t," ").concat(o):t,onClick:()=>a(le),children:[(0,re.jsx)("span",{children:"Profile"}),(0,re.jsx)("span",{className:d,children:"\u203a"})]}),(0,re.jsxs)("div",{className:s===ce?"".concat(t," ").concat(o):t,onClick:()=>a(ce),children:[(0,re.jsx)("span",{children:"Change password"}),(0,re.jsx)("span",{className:d,children:"\u203a"})]}),(0,re.jsxs)("div",{className:s===ie?"".concat(t," ").concat(o):t,onClick:()=>a(ie),children:[(0,re.jsx)("span",{children:"Preferences"}),(0,re.jsx)("span",{className:d,children:"\u203a"})]}),(0,re.jsxs)("div",{className:s===te?"".concat(t," ").concat(o):t,onClick:()=>a(te),children:[(0,re.jsx)("span",{children:"Membership application"}),(0,re.jsx)("span",{className:d,children:"\u203a"})]}),(0,re.jsxs)("div",{className:t,onClick:Se,children:[(0,re.jsx)("span",{children:"Sign out"}),(0,re.jsx)("span",{className:d,children:"\u203a"})]})]}),[s]);return(0,re.jsx)("div",{className:l,children:(0,re.jsxs)("div",{className:c,children:[De,(0,re.jsxs)("main",{className:h,children:[s===le&&(0,re.jsxs)("section",{className:m,children:[(0,re.jsxs)("header",{className:u,children:[(0,re.jsx)("h2",{className:x,children:"Profile"}),(0,re.jsxs)("p",{className:_,children:["Here you can edit your phone number and email address. This information is not visible to others. If you need to amend your personal details please get in touch. ",(0,re.jsx)("a",{className:j,href:"#",children:"Contact us"})]})]}),(0,re.jsx)("div",{className:p,children:(0,re.jsxs)("div",{className:f,children:[(0,re.jsx)("div",{className:E,onClick:()=>{pe(!0)},title:"\u70b9\u51fb\u66f4\u6362\u5934\u50cf",children:(0,re.jsx)(V.A,{size:80,src:ee.A.returnFileUrl(ae.avatar),children:null===(e=ae.username)||void 0===e?void 0:e[0]})}),(0,re.jsxs)("div",{className:v,children:[(0,re.jsx)("div",{className:N,children:ae.username}),(0,re.jsxs)("div",{className:g,children:["Location: ",ae.location||"\u2014"]})]})]})}),console.log(ae),(0,re.jsxs)("div",{className:y,children:[(0,re.jsxs)("div",{className:I,children:[(0,re.jsx)("div",{className:A,children:"Email"}),(0,re.jsx)("div",{className:U,children:ae.email})]}),(0,re.jsxs)("div",{className:I,children:[(0,re.jsx)("div",{className:A,children:"Date of birth"}),(0,re.jsx)("div",{className:U,children:ae.date_of_birth||"\u2014"})]}),(0,re.jsxs)("div",{className:I,children:[(0,re.jsx)("div",{className:A,children:"Location"}),(0,re.jsx)("div",{className:U,children:ae.location||"\u2014"})]}),(0,re.jsxs)("div",{className:I,children:[(0,re.jsx)("div",{className:A,children:"Phone"}),(0,re.jsx)("div",{className:U,children:ae.phone||"\u2014"})]}),(0,re.jsxs)("div",{className:I,children:[(0,re.jsx)("div",{className:A,children:"Gender"}),(0,re.jsx)("div",{className:U,children:ae.gender||"\u2014"})]})]}),(0,re.jsx)(H.Ay,{className:w,onClick:()=>ue(!0),children:"Edit information"}),(0,re.jsx)(z.A,{title:"Edit profile",open:me,onCancel:()=>ue(!1),footer:null,destroyOnClose:!0,children:(0,re.jsxs)(Z.A,{layout:"vertical",initialValues:ae,onFinish:e=>{const s=(0,n.A)({},e);ee.A.patch({url:"/api_v1/user/-1/",data:s,actionType:(0,se.A)().PatchUserInfo,Success:()=>{Ce(),he(s=>(0,n.A)((0,n.A)({},s),e)),G.Ay.success("\u221a")}}),ue(!1)},children:[(0,re.jsx)(Z.A.Item,{label:"Email",name:"email",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u90ae\u7bb1"}],children:(0,re.jsx)(K.A,{placeholder:"your@email.com"})}),(0,re.jsx)(Z.A.Item,{label:"Date of birth",name:"date_of_birth",getValueProps:e=>({value:e?ne()(e):null}),normalize:e=>e?ne()(e).format("YYYY-MM-DD"):null,children:(0,re.jsx)(Q.A,{style:{width:"100%"}})}),(0,re.jsx)(Z.A.Item,{label:"Location",name:"location",children:(0,re.jsx)(K.A,{placeholder:"location"})}),(0,re.jsx)(Z.A.Item,{label:"Phone",name:"phone",children:(0,re.jsx)(K.A,{placeholder:"Phone"})}),(0,re.jsx)(Z.A.Item,{label:"Gender",name:"gender",children:(0,re.jsx)(K.A,{placeholder:"Ghone"})}),(0,re.jsxs)("div",{className:P,children:[(0,re.jsx)(H.Ay,{onClick:()=>ue(!1),children:"Cancel"}),(0,re.jsx)(H.Ay,{type:"primary",htmlType:"submit",children:"Save"})]})]})}),(0,re.jsxs)(z.A,{title:"Change avatar",open:je,onCancel:()=>pe(!1),footer:null,destroyOnClose:!0,className:X,children:[(0,re.jsx)("input",{ref:be,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{var s;const a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!a)return;const n=new FileReader;n.onload=()=>{ve(n.result),ge(1),Ie({x:0,y:0})},n.readAsDataURL(a),e.target.value=""}}),(0,re.jsx)("div",{className:D,children:fe?(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)("div",{className:R,ref:Me,onMouseDown:e=>{e.preventDefault(),Ye(e.clientX,e.clientY)},onMouseMove:e=>{Pe(e.clientX,e.clientY)},onMouseUp:Ee,onMouseLeave:Ee,onTouchStart:e=>{const s=e.touches;if(1===s.length){const e=s[0];Ye(e.clientX,e.clientY)}else if(2===s.length){const e=s[0],a=s[1],n=Math.sqrt(Math.pow(a.clientX-e.clientX,2)+Math.pow(a.clientY-e.clientY,2));Ue.current={startDistance:n,startScale:Ne}}},onTouchMove:e=>{const s=e.touches;if(1===s.length){const e=s[0];Pe(e.clientX,e.clientY)}else if(2===s.length){const e=s[0],a=s[1],n=Math.sqrt(Math.pow(a.clientX-e.clientX,2)+Math.pow(a.clientY-e.clientY,2)),{startDistance:r,startScale:l}=Ue.current;if(r>0){const e=Xe(l*(n/r),.5,4);if(ge(e),we.current&&Me.current){const s=Me.current.clientWidth,a=we.current,n=a.naturalWidth,r=a.naturalHeight,l=Math.max(s/n,s/r)*e,c=n*l,i=r*l,t=Math.max(0,(c-s)/2),o=Math.max(0,(i-s)/2);Ie(e=>({x:Xe(e.x,-t,t),y:Xe(e.y,-o,o)}))}}}},onTouchEnd:Ee,onWheel:e=>{e.preventDefault();const s=e.deltaY>0?-.1:.1,a=Xe(Ne+s,.5,4);if(ge(a),we.current&&Me.current){const e=Me.current.clientWidth,s=we.current,n=s.naturalWidth,r=s.naturalHeight,l=Math.max(e/n,e/r)*a,c=n*l,i=r*l,t=Math.max(0,(c-e)/2),o=Math.max(0,(i-e)/2);Ie(e=>({x:Xe(e.x,-t,t),y:Xe(e.y,-o,o)}))}},children:[(0,re.jsx)("img",{ref:we,src:fe,alt:"avatar",className:F,style:{transform:"translate(-50%, -50%) translate(".concat(ye.x,"px, ").concat(ye.y,"px) scale(").concat(Ne,")")},draggable:!1}),(0,re.jsx)("div",{className:q})]}),(0,re.jsxs)("div",{className:L,children:[(0,re.jsxs)("div",{className:W,children:[(0,re.jsx)("span",{className:J,children:"\u7f29\u653e"}),(0,re.jsx)($.A,{className:O,min:.1,max:4,step:.01,value:Ne,onChange:e=>{const s=Xe(e,.1,4);if(ge(s),we.current&&Me.current){const e=Me.current.clientWidth,a=we.current,n=a.naturalWidth,r=a.naturalHeight,l=Math.max(e/n,e/r)*s,c=n*l,i=r*l,t=Math.max(0,(c-e)/2),o=Math.max(0,(i-e)/2);Ie(e=>({x:Xe(e.x,-t,t),y:Xe(e.y,-o,o)}))}}})]}),(0,re.jsxs)("div",{className:B,children:[(0,re.jsx)(H.Ay,{onClick:ke,children:"\u91cd\u65b0\u9009\u62e9"}),(0,re.jsx)(H.Ay,{type:"primary",onClick:()=>{const e=(()=>{const e=we.current,s=Me.current;if(!e||!s)return null;const a=s.clientWidth,n=document.createElement("canvas");n.width=a,n.height=a;const r=n.getContext("2d");if(!r)return null;const l=e.naturalWidth,c=e.naturalHeight,i=Math.max(a/l,a/c)*Ne,t=l*i,o=c*i,d=a/2+ye.x-t/2,h=a/2+ye.y-o/2;return r.clearRect(0,0,a,a),r.drawImage(e,d,h,t,o),n.toDataURL("image/png")})();if(!e)return void G.Ay.error("\u88c1\u526a\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5");const s=e.split(",")[1],a=atob(s),r=new Uint8Array(a.length);for(let n=0;n<a.length;n++)r[n]=a.charCodeAt(n);const l=new Blob([r],{type:"image/jpeg"}),c=new FormData;c.append("cover",l,"avatar.jpg"),ee.A.post({url:"programmer/set_password/",data:c,actionType:(0,se.A)().PostUserCover,Success:e=>{let s=oe(),a=(0,n.A)((0,n.A)({},s.user_info),{},{cover:e.src});s.user_info=a,localStorage.setItem("userInfo",JSON.stringify(s)),he(s=>(0,n.A)((0,n.A)({},s),{},{avatar:e.src})),window.dispatchEvent(new CustomEvent("userAvatarUpdated",{detail:{avatar:e.src}}))},Error:e=>{console.log(e)}}),console.log("submit_avatar",{avatarDataUrl:e}),G.Ay.success("\u5df2\u6253\u5370\u5230\u63a7\u5236\u53f0"),pe(!1)},children:"\u4fdd\u5b58\u5934\u50cf"})]})]})]}):(0,re.jsx)("div",{className:T,children:(0,re.jsx)(H.Ay,{type:"primary",onClick:ke,children:"\u9009\u62e9\u56fe\u7247"})})})]})]}),s===ce&&(0,re.jsxs)("section",{className:m,children:[(0,re.jsx)("header",{className:u,children:(0,re.jsx)("h2",{className:x,children:"Change password"})}),(0,re.jsxs)(Z.A,{layout:"vertical",className:b,onFinish:e=>{G.Ay.success("\u5df2\u6253\u5370\u5230\u63a7\u5236\u53f0"),_e(!1)},children:[(0,re.jsx)(Z.A.Item,{label:"Current password",name:"oldPassword",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5f53\u524d\u5bc6\u7801"}],children:(0,re.jsx)(K.A.Password,{placeholder:"Current password"})}),(0,re.jsx)(Z.A.Item,{label:"New password",name:"newPassword",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801"}],children:(0,re.jsx)(K.A.Password,{placeholder:"New password"})}),(0,re.jsx)(Z.A.Item,{label:"Confirm password",name:"confirmPassword",dependencies:["newPassword"],rules:[{required:!0,message:"\u8bf7\u786e\u8ba4\u5bc6\u7801"}],children:(0,re.jsx)(K.A.Password,{placeholder:"Confirm password"})}),(0,re.jsx)(H.Ay,{className:w,htmlType:"submit",children:"Update password"})]})]}),s===te&&(0,re.jsxs)("section",{className:m,children:[(0,re.jsx)("header",{className:u,children:(0,re.jsx)("h2",{className:x,children:"Membership application"})}),(0,re.jsx)("div",{className:b,children:(0,re.jsxs)("div",{className:M,children:[(0,re.jsxs)("div",{children:[(0,re.jsx)("div",{className:C,children:"Tier"}),(0,re.jsx)("div",{className:S,children:"\u2014"})]}),(0,re.jsxs)("div",{children:[(0,re.jsx)("div",{className:C,children:"Join date"}),(0,re.jsx)("div",{className:S,children:"\u2014"})]}),(0,re.jsxs)("div",{children:[(0,re.jsx)("div",{className:C,children:"Expiry"}),(0,re.jsx)("div",{className:S,children:"\u2014"})]})]})}),(0,re.jsxs)("div",{className:b,children:[(0,re.jsx)("div",{className:k,children:"Propose a new member"}),(0,re.jsxs)(Z.A,{layout:"inline",onFinish:e=>{G.Ay.success("\u5df2\u6253\u5370\u5230\u63a7\u5236\u53f0")},className:Y,children:[(0,re.jsx)(Z.A.Item,{name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u59d3\u540d"}],children:(0,re.jsx)(K.A,{placeholder:"Name"})}),(0,re.jsx)(Z.A.Item,{name:"email",rules:[{required:!0,message:"\u8bf7\u8f93\u5165Email"}],children:(0,re.jsx)(K.A,{placeholder:"Email"})}),(0,re.jsx)(Z.A.Item,{children:(0,re.jsx)(H.Ay,{type:"primary",htmlType:"submit",children:"Submit"})})]})]})]}),s===ie&&(0,re.jsxs)("section",{className:m,children:[(0,re.jsxs)("header",{className:u,children:[(0,re.jsx)("h2",{className:x,children:"Preferences"}),(0,re.jsx)("p",{className:_,children:"You can set your basic preferences here."})]}),(0,re.jsx)("div",{className:b,children:"No preferences yet."})]})]})]})})}}}]);
//# sourceMappingURL=411.836140cb.chunk.js.map